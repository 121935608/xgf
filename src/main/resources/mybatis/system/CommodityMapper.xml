<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CommodityMapper">

	<resultMap id="CommodityResult" type="Commodity">
		<result column="commodityName" property="commodityName" />
		<result column="commodityNo" property="commodityNo" />
		<result column="saleNum" property="saleNum" />
		<result column="salePrice" property="salePrice" />
		<result column="inPrice" property="inPrice" />
	</resultMap>
	
	<select id="pageInfoQuery" parameterType="PageUtilEntity" resultMap="CommodityResult">
		SELECT c.commodityName,c.commodityNo,SUM(t.commodityNum) saleNum,c.salePrice,c.inPrice
		FROM t_commodity c LEFT JOIN t_order_detail t ON c.commodityName=t.commodityName
		WHERE 1=1
		<if test="relationMap.beginTime != null and relationMap.beginTime != ''"><!-- 开始时间检索 -->
			AND DATE_FORMAT(t.addTime,'%Y%m%d') &gt;= DATE_FORMAT(#{relationMap.beginTime},'%Y%m%d')
		</if>
		<if test="relationMap.endTime != null and relationMap.endTime != ''"><!-- 结束时间检索 -->
			AND DATE_FORMAT(t.addTime,'%Y%m%d') &lt;= DATE_FORMAT(#{relationMap.endTime},'%Y%m%d')
		</if>
		<if test="relationMap.commodityName !=null and relationMap.commodityName !=''">
			AND (
			c.commodityName LIKE CONCAT(CONCAT('%', #{relationMap.commodityName}),'%')
			OR
			c.commodityNo LIKE CONCAT(CONCAT('%', #{relationMap.commodityName}),'%')
			)
		</if><!--关键词查询-->
		GROUP BY c.commodityNo,c.commodityName,c.salePrice,c.inPrice
	</select>
</mapper> 