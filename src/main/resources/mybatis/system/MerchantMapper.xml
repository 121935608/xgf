<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MerchantMapper">
    <resultMap id="MerchantResult" type="Merchant">
        <result column="userId" property="userId" jdbcType="VARCHAR" />
        <result column="mobilePhone" property="mobilePhone" jdbcType="VARCHAR" />
        <result column="storeName" property="storeName" jdbcType="VARCHAR" />
        <result column="userName" property="userName" jdbcType="VARCHAR" />
        <result column="phone" property="phone" jdbcType="VARCHAR" />
        <result column="locked" property="locked" jdbcType="INTEGER" />
        <result column="storeId" property="storeId" jdbcType="VARCHAR" />

    </resultMap>

    <resultMap id="BalanceResult" type="Balance">
        <result column="payTime" property="payTime"/>
        <result column="totalPrice" property="totalPrice"/>
        <result column="remain" property="remain"/>
    </resultMap>


    <select id="pageInfoQuery" parameterType="PageUtilEntity" resultMap="MerchantResult">
        SELECT s.userId,t.storeId,s.mobilePhone,t.storeName,t.userName,t.phone,s.locked
        FROM sys_user s
        LEFT JOIN t_store t ON s.userId=t.userId
        WHERE 1=1 AND s.type='B'
        <if test="relationMap.status!= null and relationMap.status!=''">
            AND s.locked = #{relationMap.status}
        </if>
        <if test="relationMap.name !=null and relationMap.name !=''">
            AND
            (
            s.mobilePhone LIKE CONCAT(CONCAT('%', #{relationMap.name}),'%')
            OR
            t.storeName LIKE CONCAT(CONCAT('%', #{relationMap.name}),'%')
            )
        </if><!--关键词查询-->
    </select>

    <select id="getMerchantInfo" parameterType="Merchant" resultType="Merchant">
        SELECT s.userId,s.mobilePhone,t.storeName,t.userName,t.phone,s.locked
        FROM sys_user s
        LEFT JOIN t_store t ON s.userId=t.userId
        WHERE t.storeId=#{storeId}
    </select>

   <select id="userAccountQuery" resultType="AccountInfo">
        SELECT s.storeName,s.userName,s.idCard,s.phone,s.area,s.address,
        s.frontPic,s.backPic,s.licensePic,s.frontStorePic,s.innerStorePic,
        b.bankType,b.accountType,b.userName bankUserName,b.cardNumber,
        b.idType,b.idCard cIdCard,b.remark
        FROM t_store s LEFT JOIN t_bankCard b ON s.userId=b.userId WHERE s.storeId=#{storeId}
    </select>

    <update id="updateMerchantInfo" parameterType="User">
        UPDATE sys_user
        <set>
            <if test="status!=null and status!=''">locked=#{status}</if>
        </set>
        WHERE 1=1
        <if test="userId != null and userId  != ''">and userId = #{userId}</if>
    </update>

    <select id="AccountpageInfoQuery" parameterType="PageUtilEntity" resultMap="BalanceResult">
        SELECT o.payTime payTime,o.totalPrice,s.remain
        FROM t_order o JOIN t_store s ON o.userId=s.userId
        WHERE 1=1
        <if test="relationMap.userId!=null and relationMap.userId!=''">AND o.userId=#{relationMap.userId}</if>
    </select>
</mapper>